$here = Split-Path -Parent $PSCommandPath
$here = Split-Path -Parent $here

$listOfFilesLocation = "$here/artifacts/list_of_files.json" 

$listOfFiles = Get-Content -Path $listOfFilesLocation | ConvertFrom-Json

$componentByFile = @{}

$folderPath = "$here/data/raw_flatterned"
if (!(Test-Path $folderPath -PathType Container)) {
    New-Item -ItemType Directory -Force -Path $folderPath
}

foreach ($fileName in $listOfFiles) {

    $file = "$here/data/raw_flatterned/$fileName"

    $fileContent = Get-Content -Path $file | ConvertFrom-Json 

    $componentByFile.Add($fileName, $fileContent.packages.name)
}

$folderPath = "$here/artifacts/scanned_sboms"
if (!(Test-Path $folderPath -PathType Container)) {
    New-Item -ItemType Directory -Force -Path $folderPath
}


$componentByFile | ConvertTo-Json | Out-File "$here/artifacts/component_by_file.json"

Remove-Item $here/data/raw_flatterned/* -Recurse -Force